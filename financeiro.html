<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admira Mission Finance</title>
    
    <!-- Configura√ß√µes de PWA (App) -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0F3555"> <!-- Azul Marinho Admira -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Admira Mission Finance">
    <link rel="apple-touch-icon" href="rocket_logo.png">
    <link rel="icon" type="image/png" href="rocket_logo.png">

    <!-- React e Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            background-color: #05121d; /* Vers√£o muito escura do Azul Marinho para contraste */
            color: #e2e8f0; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Neon Laranja (Identidade Admira) */
        .neon-text-orange { text-shadow: 0 0 5px rgba(245, 148, 37, 0.6); }
        .neon-box { 
            box-shadow: 0 0 15px rgba(245, 148, 37, 0.1); 
            border: 1px solid rgba(15, 53, 85, 0.5); 
        }
        
        /* Inputs Dark */
        input, select {
            background-color: #0F3555; 
            color: white;
            border: 1px solid #1e4060;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #F59425;
            box-shadow: 0 0 8px rgba(245, 148, 37, 0.3);
        }
        
        .custom-checkbox {
            accent-color: #F59425;
            width: 16px;
            height: 16px;
        }

        .fade-in { animation: fadeIn 0.3s ease-in; }
        .animate-pop { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; color: black; }
            .shadow-xl, .neon-box { box-shadow: none !important; border: 1px solid #ddd !important; }
            input, select { background-color: white; color: black; border: 1px solid #ddd; }
            
            /* Ajustes de cor para impress√£o do logo */
            .print\:text-black { color: black !important; text-shadow: none !important; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #05121d; }
        ::-webkit-scrollbar-thumb { background: #0F3555; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #F59425; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // √çcones
        const Icons = {
            TrendingUp: ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>,
            DollarSign: ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>,
            FileText: ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>,
            Calculator: ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>,
            PlusCircle: ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>,
            MinusCircle: ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg>,
            Trash2: ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Save: ({size=20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            Filter: ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>,
            Printer: ({size=18}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>,
            Download: ({size=18}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>,
            HelpCircle: ({size=16, className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>,
            Clock: ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Check: ({size=14}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Repeat: ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>,
            Calendar: ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Alert: ({size=24, className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
            Rocket: ({size=24, className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.1 4-1 4-1"></path><path d="M12 15v5s3.03-.55 4-2c1.1-1.62 1-4 1-4"></path></svg>,
            BookOpen: ({size=20, className=""}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>,
            X: ({size=24, className=""}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        // Tooltip Component
        const Tooltip = ({ content }) => {
            const [show, setShow] = useState(false);
            return (
                <div className="relative inline-block ml-2 align-middle">
                    <button 
                        className="text-slate-400 hover:text-[#F59425] transition-colors focus:outline-none cursor-help"
                        onMouseEnter={() => setShow(true)}
                        onMouseLeave={() => setShow(false)}
                        onClick={() => setShow(!show)}
                        type="button"
                    >
                        <Icons.HelpCircle size={15} />
                    </button>
                    {show && (
                        <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-[#0F3555] text-white text-xs rounded-lg shadow-[0_0_15px_rgba(245,148,37,0.3)] z-50 pointer-events-none fade-in border border-[#F59425]/30">
                            {content}
                            <div className="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-[#0F3555]"></div>
                        </div>
                    )}
                </div>
            )
        }

        function App() {
            const [activeTab, setActiveTab] = useState('caixa');
            const [alertConfig, setAlertConfig] = useState(null);
            const [isHelpOpen, setIsHelpOpen] = useState(false); 

            // --- HELPERS PARA ALERTAS ---
            const showConfirm = (msg, action) => setAlertConfig({ type: 'confirm', message: msg, onConfirm: action });
            const closeAlert = () => setAlertConfig(null);

            // --- FLUXO DE CAIXA ---
            const [transactions, setTransactions] = useState(() => {
                const saved = localStorage.getItem('financas_app_transactions');
                return saved ? JSON.parse(saved) : [
                    { id: 1, description: 'Exemplo: Venda Inicial', amount: 150.00, type: 'entrada', category: 'Vendas', date: new Date().toISOString().split('T')[0], status: 'pago' },
                ];
            });
            
            useEffect(() => {
                localStorage.setItem('financas_app_transactions', JSON.stringify(transactions));
            }, [transactions]);

            const [newDesc, setNewDesc] = useState('');
            const [newAmount, setNewAmount] = useState('');
            const [newType, setNewType] = useState('entrada');
            const [newStatus, setNewStatus] = useState('pago'); // pago ou agendado
            const [newDate, setNewDate] = useState(new Date().toISOString().split('T')[0]);
            
            // Estado para parcelamento
            const [isInstallment, setIsInstallment] = useState(false);
            const [installments, setInstallments] = useState(2);

            // Filtros de Relat√≥rio
            const [periodOption, setPeriodOption] = useState('current_month'); // Default para m√™s atual
            const [filterStart, setFilterStart] = useState('');
            const [filterEnd, setFilterEnd] = useState('');
            const [filterType, setFilterType] = useState('todos');
            const [selectedMonth, setSelectedMonth] = useState('');

            // Efeito para definir as datas iniciais do filtro com base no padr√£o
            useEffect(() => {
                handlePeriodChange({ target: { value: 'current_month' } });
            }, []);

            // C√°lculos Totais (Realizado)
            const totalEntradas = transactions.filter(t => t.type === 'entrada' && t.status === 'pago').reduce((acc, curr) => acc + curr.amount, 0);
            const totalSaidas = transactions.filter(t => t.type === 'saida' && t.status === 'pago').reduce((acc, curr) => acc + curr.amount, 0);
            const saldo = totalEntradas - totalSaidas;

            // C√°lculos Totais Globais (Previs√£o de tudo)
            const totalEntradasPrev = transactions.filter(t => t.type === 'entrada').reduce((acc, curr) => acc + curr.amount, 0);
            const totalSaidasPrev = transactions.filter(t => t.type === 'saida').reduce((acc, curr) => acc + curr.amount, 0);
            const saldoPrevistoTotal = totalEntradasPrev - totalSaidasPrev;

            // --- C√ÅLCULOS DO M√äS ATUAL (Realizado) ---
            const getCurrentMonthBalance = () => {
                const now = new Date();
                const currentMonthStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
                
                const monthTransactions = transactions.filter(t => 
                    t.date.startsWith(currentMonthStr) && t.status === 'pago'
                );

                const income = monthTransactions.filter(t => t.type === 'entrada').reduce((acc, t) => acc + t.amount, 0);
                const expense = monthTransactions.filter(t => t.type === 'saida').reduce((acc, t) => acc + t.amount, 0);
                
                return income - expense;
            };
            const saldoMesAtual = getCurrentMonthBalance();

             // --- C√ÅLCULOS DO M√äS ATUAL (Previsto) ---
            const getCurrentMonthForecast = () => {
                const now = new Date();
                const currentMonthStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
                
                // Filtra todas as transa√ß√µes do m√™s (independente de status)
                const monthTransactions = transactions.filter(t => 
                    t.date.startsWith(currentMonthStr)
                );

                const income = monthTransactions.filter(t => t.type === 'entrada').reduce((acc, t) => acc + t.amount, 0);
                const expense = monthTransactions.filter(t => t.type === 'saida').reduce((acc, t) => acc + t.amount, 0);
                
                return income - expense;
            };
            const saldoPrevistoMesAtual = getCurrentMonthForecast();


            const addTransaction = () => {
                if (!newDesc || !newAmount) return;
                const baseAmount = parseFloat(newAmount);
                const newTransactionsList = [];

                if (isInstallment && installments > 1) {
                    const [year, month, day] = newDate.split('-').map(Number);
                    
                    for (let i = 0; i < installments; i++) {
                        const currentMonthIndex = month - 1 + i;
                        const targetYear = year + Math.floor(currentMonthIndex / 12);
                        const targetMonth = currentMonthIndex % 12;
                        const daysInMonth = new Date(targetYear, targetMonth + 1, 0).getDate();
                        const targetDay = Math.min(day, daysInMonth);
                        const dateStr = `${targetYear}-${String(targetMonth + 1).padStart(2, '0')}-${String(targetDay).padStart(2, '0')}`;
                        
                        newTransactionsList.push({
                            id: Date.now() + i,
                            description: `${newDesc} (${i + 1}/${installments})`,
                            amount: baseAmount, 
                            type: newType,
                            status: i === 0 ? newStatus : 'agendado', 
                            category: 'Geral',
                            date: dateStr
                        });
                    }
                } else {
                    newTransactionsList.push({
                        id: Date.now(),
                        description: newDesc,
                        amount: baseAmount,
                        type: newType,
                        status: newStatus,
                        category: 'Geral',
                        date: newDate
                    });
                }

                setTransactions([...newTransactionsList, ...transactions]);
                setNewDesc('');
                setNewAmount('');
                setIsInstallment(false);
                setInstallments(2);
            };

            const removeTransaction = (id) => {
                showConfirm('Tem certeza que deseja excluir este lan√ßamento?', () => {
                    setTransactions(transactions.filter(t => t.id !== id));
                });
            };

            const toggleStatus = (id) => {
                setTransactions(transactions.map(t => 
                    t.id === id ? { ...t, status: t.status === 'pago' ? 'agendado' : 'pago' } : t
                ));
            };

            const handlePeriodChange = (e) => {
                const option = e.target ? e.target.value : e; // Suporta chamada direta ou evento
                setPeriodOption(option);
                
                const today = new Date();
                let start = '';
                let end = '';

                // Ajuste de fuso hor√°rio para garantir datas locais corretas
                const toLocalISO = (date) => {
                    const offset = date.getTimezoneOffset();
                    return new Date(date.getTime() - (offset*60*1000)).toISOString().split('T')[0];
                };

                if (option === 'current_month') {
                    start = toLocalISO(new Date(today.getFullYear(), today.getMonth(), 1));
                    end = toLocalISO(new Date(today.getFullYear(), today.getMonth() + 1, 0));
                } else if (option === 'last_month') {
                    start = toLocalISO(new Date(today.getFullYear(), today.getMonth() - 1, 1));
                    end = toLocalISO(new Date(today.getFullYear(), today.getMonth(), 0));
                } else if (option === 'last_7_days') {
                    const past = new Date(today);
                    past.setDate(today.getDate() - 7);
                    start = toLocalISO(past);
                    end = toLocalISO(today);
                } else if (option === 'last_30_days') {
                    const past = new Date(today);
                    past.setDate(today.getDate() - 30);
                    start = toLocalISO(past);
                    end = toLocalISO(today);
                } else if (option === 'today') {
                     start = toLocalISO(today);
                     end = toLocalISO(today);
                }
                
                if (option !== 'custom') {
                    setFilterStart(start);
                    setFilterEnd(end);
                } else {
                    setFilterStart('');
                    setFilterEnd('');
                }
            };

            const getFilteredTransactions = () => {
                return transactions.filter(t => {
                    const matchType = filterType === 'todos' ? true : t.type === filterType;
                    const matchStart = filterStart ? t.date >= filterStart : true;
                    const matchEnd = filterEnd ? t.date <= filterEnd : true;
                    return matchType && matchStart && matchEnd;
                }).sort((a, b) => b.date.localeCompare(a.date));
            };

            const filteredData = getFilteredTransactions();
            const filteredEntradas = filteredData.filter(t => t.type === 'entrada').reduce((acc, curr) => acc + curr.amount, 0);
            const filteredSaidas = filteredData.filter(t => t.type === 'saida').reduce((acc, curr) => acc + curr.amount, 0);
            const filteredSaldo = filteredEntradas - filteredSaidas;

            const exportToCSV = () => {
                const headers = ["Data", "Descri√ß√£o", "Tipo", "Status", "Valor (R$)"];
                const rows = filteredData.map(t => {
                    let val = t.amount;
                    if (t.type === 'saida') {
                        val = -val;
                    }
                    return [
                        formatDate(t.date),
                        t.description,
                        t.type,
                        t.status,
                        val.toFixed(2).replace('.', ',')
                    ];
                });
                const csvContent = "data:text/csv;charset=utf-8," + headers.join(";") + "\n" + rows.map(e => e.join(";")).join("\n");
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `relatorio_financeiro_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const formatDate = (dateString) => {
                if (!dateString) return '-';
                const [year, month, day] = dateString.split('-');
                return `${day}/${month}/${year}`;
            };

            // Helpers para M√™s (CORRIGIDO PARA MOSTRAR HIST√ìRICO MAIOR)
            const getMonthOptions = () => {
                const options = [];
                const today = new Date();
                // Mostra 36 meses antes (3 anos) e 12 meses depois
                for (let i = -36; i <= 12; i++) { 
                    const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
                    const label = d.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
                    // Format YYYY-MM
                    const val = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
                    options.push({ label: label.charAt(0).toUpperCase() + label.slice(1), value: val });
                }
                return options;
            };

            // --- CALCULADORA DE PRE√áO JUSTO ---
            const [salary, setSalary] = useState(3000); 
            const [hoursPerDay, setHoursPerDay] = useState(8);
            const [daysPerMonth, setDaysPerMonth] = useState(22);
            
            const hoursPerMonth = hoursPerDay * daysPerMonth;
            const costPerHour = hoursPerMonth > 0 ? salary / hoursPerMonth : 0;

            const [materialCost, setMaterialCost] = useState(50); 
            const [timeSpent, setTimeSpent] = useState(60); 
            const laborCost = (timeSpent / 60) * costPerHour;
            const totalBaseCost = materialCost + laborCost;

            const [taxes, setTaxes] = useState(4); 
            const [cardFee, setCardFee] = useState(4.5);
            const [otherExpenses, setOtherExpenses] = useState(5); 
            const [margin, setMargin] = useState(30);

            const totalVariablePercent = taxes + cardFee + otherExpenses;
            const divisor = (100 - (totalVariablePercent + margin)) / 100;
            const sellingPrice = divisor > 0 ? totalBaseCost / divisor : 0;
            const minDivisor = (100 - totalVariablePercent) / 100;
            const minPrice = minDivisor > 0 ? totalBaseCost / minDivisor : 0;

            return (
                <div className="max-w-5xl mx-auto my-4 bg-[#0F3555] rounded-xl shadow-2xl overflow-hidden border border-[#0F3555] print:shadow-none print:border-none print:my-0 print:w-full min-h-[90vh]">
                    
                    {/* Header */}
                    <div className="bg-[#0F3555]/50 backdrop-blur border-b border-[#F59425]/20 p-6 flex justify-between items-center print:bg-white print:text-black">
                        <div>
                            <h1 className="text-2xl font-bold flex items-center gap-2 text-white select-none print:text-black">
                                <Icons.TrendingUp className="print:hidden" /> 
                                <div className="flex items-center">
                                    <span className="text-white print:text-black">Ad</span>
                                    <span className="text-[#F59425] neon-text-orange print:text-black print:shadow-none">mira</span>
                                    <span className="text-white ml-2 print:text-black">Mission Finance</span>
                                </div>
                            </h1>
                            <h1 className="hidden print:block text-2xl font-bold text-black mb-1">
                                Admira Mission Finance
                            </h1>
                            <p className="text-slate-400 text-sm mt-1 print:hidden">Controle Financeiro & Precifica√ß√£o</p>
                        </div>
                        <div className="flex items-center gap-4">
                            <button 
                                onClick={() => setIsHelpOpen(true)}
                                className="hidden md:flex items-center gap-2 text-[#F59425] hover:text-white transition-colors bg-[#05121d] px-3 py-1.5 rounded-full border border-[#F59425]/30 text-sm font-bold print:hidden"
                            >
                                <Icons.BookOpen size={16} />
                                Ajuda
                            </button>
                            <div className="text-right">
                                <p className="text-sm text-slate-400 print:text-black">Saldo Real (Caixa)</p>
                                <p className={`text-2xl font-bold ${saldo >= 0 ? 'text-emerald-400' : 'text-red-400'} print:text-black`}>
                                    R$ {saldo.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Navega√ß√£o */}
                    <div className="flex border-b border-[#F59425]/20 bg-[#05121d]/50 no-print">
                        <button onClick={() => setActiveTab('caixa')} className={`flex-1 py-4 flex justify-center items-center gap-2 font-medium transition-all ${activeTab === 'caixa' ? 'text-[#F59425] border-b-2 border-[#F59425] bg-[#0F3555]' : 'text-slate-400 hover:text-white hover:bg-[#0F3555]'}`}>
                            <Icons.DollarSign size={18} /> Fluxo de Caixa
                        </button>
                        <button onClick={() => setActiveTab('relatorios')} className={`flex-1 py-4 flex justify-center items-center gap-2 font-medium transition-all ${activeTab === 'relatorios' ? 'text-[#F59425] border-b-2 border-[#F59425] bg-[#0F3555]' : 'text-slate-400 hover:text-white hover:bg-[#0F3555]'}`}>
                            <Icons.FileText size={18} /> Relat√≥rios
                        </button>
                        <button onClick={() => setActiveTab('precificacao')} className={`flex-1 py-4 flex justify-center items-center gap-2 font-medium transition-all ${activeTab === 'precificacao' ? 'text-[#F59425] border-b-2 border-[#F59425] bg-[#0F3555]' : 'text-slate-400 hover:text-white hover:bg-[#0F3555]'}`}>
                            <Icons.Calculator size={18} /> Pre√ßo Justo
                        </button>
                    </div>

                    <div className="p-6">
                        {/* --- ABA FLUXO DE CAIXA --- */}
                        {activeTab === 'caixa' && (
                            <div className="fade-in">
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                                    <div className="bg-[#0F3555] p-4 rounded-lg border border-[#F59425]/20 flex justify-between items-center neon-box">
                                        <div><p className="text-emerald-400 text-sm font-bold uppercase">Entradas (Real)</p><p className="text-lg font-bold text-white">R$ {totalEntradas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p></div>
                                        <Icons.PlusCircle className="text-emerald-400 h-8 w-8" />
                                    </div>
                                    <div className="bg-[#0F3555] p-4 rounded-lg border border-[#F59425]/20 flex justify-between items-center shadow-lg">
                                        <div><p className="text-red-400 text-sm font-bold uppercase">Sa√≠das (Real)</p><p className="text-lg font-bold text-white">R$ {totalSaidas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p></div>
                                        <Icons.MinusCircle className="text-red-400 h-8 w-8" />
                                    </div>
                                    {/* Card de Saldo do M√™s (Atual) */}
                                    <div className="bg-[#05121d] p-4 rounded-lg border border-[#F59425]/30 flex justify-between items-center">
                                        <div>
                                            <p className="text-[#F59425] text-sm font-bold uppercase flex items-center gap-1"><Icons.Calendar size={14} /> Saldo do M√™s</p>
                                            <p className={`text-lg font-bold ${saldoMesAtual >= 0 ? 'text-emerald-400' : 'text-orange-400'}`}>R$ {saldoMesAtual.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                            <p className="text-[10px] text-slate-500">M√™s Atual (Pago)</p>
                                        </div>
                                    </div>
                                    {/* Card de Previs√£o M√äS ATUAL */}
                                    <div className="bg-[#05121d] p-4 rounded-lg border border-slate-700 flex justify-between items-center">
                                        <div>
                                            <p className="text-slate-400 text-sm font-bold uppercase flex items-center gap-1"><Icons.Clock size={14} /> Previsto (M√™s)</p>
                                            <p className={`text-lg font-bold ${saldoPrevistoMesAtual >= 0 ? 'text-cyan-400' : 'text-yellow-400'}`}>R$ {saldoPrevistoMesAtual.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                            <p className="text-[10px] text-slate-500">M√™s Atual (Inclui Futuros)</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-[#0F3555] p-5 rounded-lg mb-6 border border-[#F59425]/20 shadow-lg no-print">
                                    <h3 className="text-sm font-bold text-slate-300 mb-3 uppercase flex items-center gap-2"><Icons.PlusCircle className="w-4 h-4 text-[#F59425]" /> Novo Lan√ßamento</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-12 gap-3">
                                        <div className="md:col-span-2">
                                            <label className="text-[10px] text-slate-400 uppercase">Data</label>
                                            <input type="date" className="w-full p-2 rounded" value={newDate} onChange={(e) => setNewDate(e.target.value)} />
                                        </div>
                                        <div className="md:col-span-4">
                                            <label className="text-[10px] text-slate-400 uppercase">Descri√ß√£o</label>
                                            <input type="text" placeholder="Ex: Venda Cliente X" className="w-full p-2 rounded" value={newDesc} onChange={(e) => setNewDesc(e.target.value)} />
                                        </div>
                                        <div className="md:col-span-2">
                                            <label className="text-[10px] text-slate-400 uppercase">Valor (Parcela)</label>
                                            <input type="number" placeholder="0,00" className="w-full p-2 rounded" value={newAmount} onChange={(e) => setNewAmount(e.target.value)} />
                                        </div>
                                        <div className="md:col-span-2">
                                            <label className="text-[10px] text-slate-400 uppercase">Tipo</label>
                                            <select className="w-full p-2 rounded" value={newType} onChange={(e) => setNewType(e.target.value)}>
                                                <option value="entrada">Entrada (+)</option>
                                                <option value="saida">Sa√≠da (-)</option>
                                            </select>
                                        </div>
                                        <div className="md:col-span-2">
                                            <label className="text-[10px] text-slate-400 uppercase">Status</label>
                                            <select className="w-full p-2 rounded border border-[#F59425]/50" value={newStatus} onChange={(e) => setNewStatus(e.target.value)}>
                                                <option value="pago">‚úÖ Confirmado</option>
                                                <option value="agendado">üìÖ Agendado</option>
                                            </select>
                                        </div>
                                        
                                        {/* Op√ß√µes de Parcelamento */}
                                        <div className="md:col-span-12 flex items-center gap-4 bg-[#05121d] p-2 rounded border border-slate-700 mt-1">
                                            <label className="flex items-center gap-2 cursor-pointer text-sm text-white select-none">
                                                <input type="checkbox" className="custom-checkbox rounded" checked={isInstallment} onChange={(e) => setIsInstallment(e.target.checked)} />
                                                <Icons.Repeat size={16} />
                                                Repetir / Parcelar?
                                            </label>
                                            
                                            {isInstallment && (
                                                <div className="flex items-center gap-2 fade-in">
                                                    <span className="text-xs text-slate-400">Qtd. Meses:</span>
                                                    <input 
                                                        type="number" 
                                                        min="2" max="60" 
                                                        className="w-20 p-1 rounded text-center text-sm border border-[#F59425]" 
                                                        value={installments} 
                                                        onChange={(e) => setInstallments(Number(e.target.value))} 
                                                    />
                                                </div>
                                            )}
                                        </div>

                                        <div className="md:col-span-12 mt-2">
                                            <button onClick={addTransaction} className="w-full bg-[#F59425] text-white p-3 rounded hover:bg-orange-600 flex justify-center items-center gap-2 shadow-[0_0_10px_#F59425] transition-all font-bold text-sm uppercase"><Icons.Save size={18} /> Adicionar Lan√ßamento</button>
                                        </div>
                                    </div>
                                </div>

                                <div className="overflow-x-auto rounded-lg border border-[#F59425]/20">
                                    <table className="w-full text-left text-sm text-slate-300">
                                        <thead className="bg-[#05121d] text-slate-400 uppercase font-semibold"><tr className="border-b border-[#F59425]/20"><th className="p-3">Data</th><th className="p-3">Descri√ß√£o</th><th className="p-3 text-center">Status</th><th className="p-3 text-right">Valor</th><th className="p-3 text-center w-16 no-print">X</th></tr></thead>
                                        <tbody className="divide-y divide-[#F59425]/10">
                                            {transactions.sort((a,b) => b.date.localeCompare(a.date)).slice(0, 15).map((t) => (
                                                <tr key={t.id} className={`hover:bg-[#05121d]/50 ${t.status === 'agendado' ? 'opacity-70 italic' : ''}`}>
                                                    <td className="p-3 whitespace-nowrap">{formatDate(t.date)}</td>
                                                    <td className="p-3 font-medium text-white">{t.description}</td>
                                                    <td className="p-3 text-center cursor-pointer" onClick={() => toggleStatus(t.id)} title="Clique para alterar status">
                                                        {t.status === 'pago' 
                                                            ? <span className="bg-emerald-900/50 text-emerald-400 px-2 py-1 rounded text-xs border border-emerald-800">Pago</span> 
                                                            : <span className="bg-orange-900/50 text-orange-400 px-2 py-1 rounded text-xs border border-orange-800 flex items-center justify-center gap-1"><Icons.Clock size={10} /> Futuro</span>
                                                        }
                                                    </td>
                                                    <td className={`p-3 text-right font-bold ${t.type === 'entrada' ? 'text-emerald-400' : 'text-red-400'}`}>{t.type === 'entrada' ? '+' : '-'} R$ {t.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                                                    <td className="p-3 text-center no-print"><button onClick={() => removeTransaction(t.id)} className="text-slate-500 hover:text-red-400"><Icons.Trash2 size={16} /></button></td>
                                                </tr>
                                            ))}
                                            {transactions.length === 0 && <tr><td colSpan={5} className="p-8 text-center text-slate-500">Nenhum lan√ßamento.</td></tr>}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* --- ABA RELAT√ìRIOS --- */}
                        {activeTab === 'relatorios' && (
                            <div className="fade-in">
                                {/* CARD: Vis√£o Geral (Acumulado) - Pedido do utilizador */}
                                <div className="mb-6">
                                     <div className="bg-[#0F3555] p-4 rounded-lg border border-[#F59425]/30 flex justify-between items-center shadow-lg">
                                        <div>
                                            <p className="text-slate-400 text-sm font-bold uppercase flex items-center gap-2"><Icons.TrendingUp size={16} className="text-[#F59425]" /> Vis√£o Geral (Acumulado)</p>
                                            <p className={`text-2xl font-bold mt-1 ${saldoPrevistoTotal >= 0 ? 'text-cyan-400' : 'text-yellow-400'}`}>R$ {saldoPrevistoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                            <p className="text-[10px] text-slate-500">Saldo Previsto Total (Todo o Hist√≥rico + Futuro)</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-[#0F3555] p-4 rounded-lg mb-6 border border-[#F59425]/20 no-print">
                                    <h3 className="text-sm font-bold text-slate-300 mb-3 uppercase flex items-center gap-2"><Icons.Filter size={16} /> Filtros</h3>
                                    
                                    {/* SELETOR DE PER√çODO (Substitui meses fixos) */}
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                                        <div className="col-span-1">
                                            <label className="text-xs text-[#F59425] font-bold block mb-1">Per√≠odo</label>
                                            <select 
                                                className="w-full p-2 rounded text-sm bg-[#05121d] border border-[#F59425]/50 text-white" 
                                                value={periodOption} 
                                                onChange={handlePeriodChange}
                                            >
                                                <option value="today">Hoje</option>
                                                <option value="current_month">Este M√™s</option>
                                                <option value="last_month">M√™s Passado</option>
                                                <option value="last_7_days">√öltimos 7 dias</option>
                                                <option value="last_30_days">√öltimos 30 dias</option>
                                                <option value="custom">Personalizado</option>
                                            </select>
                                        </div>

                                        {/* Inputs de Data (Aparecem APENAS se for Personalizado) */}
                                        {periodOption === 'custom' && (
                                            <>
                                                <div><label className="text-xs text-slate-400 block mb-1">In√≠cio</label><input type="date" className="p-2 rounded text-sm w-full" value={filterStart} onChange={(e) => setFilterStart(e.target.value)} /></div>
                                                <div><label className="text-xs text-slate-400 block mb-1">Fim</label><input type="date" className="p-2 rounded text-sm w-full" value={filterEnd} onChange={(e) => setFilterEnd(e.target.value)} /></div>
                                            </>
                                        )}
                                        
                                        <div className="flex gap-2 col-span-1">
                                            <div className="flex-grow">
                                                <label className="text-xs text-slate-400 block mb-1">Tipo</label>
                                                <select className="p-2 rounded text-sm w-full bg-[#05121d]" value={filterType} onChange={(e) => setFilterType(e.target.value)}><option value="todos">Todos</option><option value="entrada">Entradas</option><option value="saida">Sa√≠das</option></select>
                                            </div>
                                            <button onClick={() => { handlePeriodChange({ target: { value: 'current_month' } }); setFilterType('todos'); }} className="px-3 py-2 text-sm text-[#F59425] underline hover:text-orange-400 self-end">Reset</button>
                                        </div>
                                    </div>
                                </div>

                                <div className="mb-6 border-b border-[#F59425]/20 pb-6">
                                    <h2 className="text-lg font-bold text-white mb-4">Resumo do Per√≠odo Selecionado</h2>
                                    <div className="grid grid-cols-3 gap-4 text-center">
                                        <div className="p-3 bg-emerald-900/30 rounded border border-emerald-800"><span className="text-xs text-emerald-400 uppercase font-bold">Receita</span><div className="text-xl font-bold text-emerald-400">R$ {filteredEntradas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div></div>
                                        <div className="p-3 bg-red-900/30 rounded border border-red-800"><span className="text-xs text-red-400 uppercase font-bold">Despesa</span><div className="text-xl font-bold text-red-400">R$ {filteredSaidas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div></div>
                                        <div className={`p-3 rounded border ${filteredSaldo >= 0 ? 'bg-[#05121d]/50 border-[#F59425]/50' : 'bg-orange-900/30 border-orange-800'}`}><span className="text-xs text-slate-300 uppercase font-bold">Resultado</span><div className={`text-xl font-bold ${filteredSaldo >= 0 ? 'text-[#F59425]' : 'text-orange-400'}`}>R$ {filteredSaldo.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div></div>
                                    </div>
                                </div>

                                <table className="w-full text-left text-sm mb-6 text-slate-300">
                                    <thead><tr className="border-b-2 border-[#F59425]/10"><th className="py-2">Data</th><th className="py-2">Descri√ß√£o</th><th className="py-2 text-center">Status</th><th className="py-2 text-right">Valor</th></tr></thead>
                                    <tbody className="divide-y divide-[#F59425]/10">
                                        {filteredData.map((t) => (
                                            <tr key={t.id}>
                                                <td className="py-2 text-slate-400">{formatDate(t.date)}</td>
                                                <td className="py-2 text-white">{t.description}</td>
                                                <td className="py-2 text-center">
                                                    {t.status === 'pago' ? <span className="text-emerald-500 text-xs">Pago</span> : <span className="text-orange-400 text-xs italic">Previsto</span>}
                                                </td>
                                                <td className="py-2 text-right font-medium text-slate-200">R$ {t.amount.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>

                                <div className="flex gap-4 justify-end no-print">
                                    <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 border border-slate-600 rounded hover:bg-slate-700 text-slate-300 transition-colors"><Icons.Printer size={18} /> Imprimir</button>
                                    <button onClick={exportToCSV} className="flex items-center gap-2 px-4 py-2 bg-[#F59425] text-white rounded hover:bg-orange-600 shadow-[0_0_10px_#F59425] transition-colors"><Icons.Download size={18} /> Baixar CSV</button>
                                </div>
                            </div>
                        )}

                        {/* --- ABA PRE√áO JUSTO 2.0 (Neon) --- */}
                        {activeTab === 'precificacao' && (
                            <div className="fade-in grid md:grid-cols-12 gap-6">
                                {/* ... existing precificacao ... */}
                                {/* COLUNA ESQUERDA: INPUTS */}
                                <div className="md:col-span-7 space-y-6">
                                    
                                    {/* 1. C√°lculo da Hora */}
                                    <div className="bg-[#0F3555] p-5 rounded-xl border border-[#F59425]/20">
                                        <h3 className="font-bold text-[#F59425] mb-4 flex items-center gap-2 border-b border-[#05121d] pb-2">
                                            <Icons.Clock size={18} /> 1. Quanto vale seu tempo?
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">
                                                    Sal√°rio Desejado
                                                    <Tooltip content="Quanto voc√™ quer tirar 'limpo' por m√™s para pagar suas contas pessoais?" />
                                                </label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 text-slate-500 text-sm">R$</span>
                                                    <input type="number" className="w-full p-2 pl-8 rounded text-sm" value={salary} onChange={(e) => setSalary(Number(e.target.value))} />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">Horas/Dia <Tooltip content="Quantas horas por dia voc√™ vai dedicar ao trabalho?" /></label>
                                                <input type="number" className="w-full p-2 rounded text-sm" value={hoursPerDay} onChange={(e) => setHoursPerDay(Number(e.target.value))} />
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">Dias/M√™s <Tooltip content="Geralmente 22 dias (segunda a sexta)." /></label>
                                                <input type="number" className="w-full p-2 rounded text-sm" value={daysPerMonth} onChange={(e) => setDaysPerMonth(Number(e.target.value))} />
                                            </div>
                                        </div>
                                        <div className="mt-3 text-right">
                                            <span className="text-xs text-slate-500 uppercase tracking-wider">Custo da sua hora: </span>
                                            <span className="text-lg font-bold text-white">R$ {costPerHour.toFixed(2)}</span>
                                        </div>
                                    </div>

                                    {/* 2. Custo do Produto */}
                                    <div className="bg-[#0F3555] p-5 rounded-xl border border-[#F59425]/20">
                                        <h3 className="font-bold text-purple-400 mb-4 flex items-center gap-2 border-b border-[#05121d] pb-2">
                                            <Icons.TrendingUp size={18} /> 2. Custo de Produ√ß√£o
                                        </h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">
                                                    Materiais / Custo Direto
                                                    <Tooltip content="Soma de tudo que voc√™ compra para fazer UM produto (ingredientes, embalagem, pe√ßa)." />
                                                </label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 text-slate-500 text-sm">R$</span>
                                                    <input type="number" className="w-full p-2 pl-8 rounded text-sm" value={materialCost} onChange={(e) => setMaterialCost(Number(e.target.value))} />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">
                                                    Tempo Gasto (minutos)
                                                    <Tooltip content="Quanto tempo voc√™ leva para fazer ou atender UM cliente?" />
                                                </label>
                                                <input type="number" className="w-full p-2 rounded text-sm" value={timeSpent} onChange={(e) => setTimeSpent(Number(e.target.value))} />
                                            </div>
                                        </div>
                                        <div className="mt-3 flex justify-between items-center text-sm border-t border-[#05121d] pt-2 text-slate-300">
                                            <span>M√£o de Obra: <b>R$ {laborCost.toFixed(2)}</b></span>
                                            <span>Custo Total Base: <b className="text-purple-300">R$ {totalBaseCost.toFixed(2)}</b></span>
                                        </div>
                                    </div>

                                    {/* 3. Venda */}
                                    <div className="bg-[#0F3555] p-5 rounded-xl border border-[#F59425]/20">
                                        <h3 className="font-bold text-emerald-400 mb-4 flex items-center gap-2 border-b border-[#05121d] pb-2">
                                            <Icons.DollarSign size={18} /> 3. Vari√°veis de Venda
                                        </h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">Imposto % <Tooltip content="Ex: MEI √© 0% (valor fixo), Simples Nacional come√ßa em 4%." /></label>
                                                <input type="number" className="w-full p-2 rounded text-sm" value={taxes} onChange={(e) => setTaxes(Number(e.target.value))} />
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">Taxa Cart√£o % <Tooltip content="M√©dia das taxas da maquininha (cr√©dito/d√©bito)." /></label>
                                                <input type="number" className="w-full p-2 rounded text-sm" value={cardFee} onChange={(e) => setCardFee(Number(e.target.value))} />
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 flex items-center">Outros % <Tooltip content="Comiss√µes, marketing, embalagem extra." /></label>
                                                <input type="number" className="w-full p-2 rounded text-sm" value={otherExpenses} onChange={(e) => setOtherExpenses(Number(e.target.value))} />
                                            </div>
                                            <div>
                                                <label className="text-xs font-bold text-[#F59425] mb-1 flex items-center">Margem % <Tooltip content="O lucro l√≠quido que voc√™ quer que sobre para a empresa crescer." /></label>
                                                <input type="number" className="w-full p-2 rounded text-sm border-[#F59425]" value={margin} onChange={(e) => setMargin(Number(e.target.value))} />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* COLUNA DIREITA: RAIO-X (RESULTADO) */}
                                <div className="md:col-span-5">
                                    <div className="bg-[#0F3555] rounded-xl overflow-hidden border border-[#F59425]/30 shadow-[0_0_20px_rgba(0,0,0,0.3)] sticky top-4">
                                        <div className="bg-[#05121d] p-4 border-b border-[#F59425]/20 text-center">
                                            <h2 className="text-[#F59425] font-bold uppercase tracking-widest text-sm">Raio-X do Pre√ßo</h2>
                                        </div>
                                        
                                        <div className="p-6 text-center">
                                            <p className="text-slate-400 text-xs uppercase mb-1">Pre√ßo de Venda Sugerido</p>
                                            <div className="text-4xl font-bold text-white neon-text-orange mb-1">
                                                R$ {sellingPrice.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                                            </div>
                                            <p className="text-xs text-slate-500">Para atingir {margin}% de lucro l√≠quido</p>
                                        </div>

                                        <div className="space-y-3 p-5 bg-[#05121d]/50 text-sm">
                                            <div className="flex justify-between text-slate-400">
                                                <span>Custo Base (Material + Tempo)</span>
                                                <span>R$ {totalBaseCost.toFixed(2)}</span>
                                            </div>
                                            <div className="flex justify-between text-red-400">
                                                <span className="flex items-center">Custos Vari√°veis ({totalVariablePercent}%) <Tooltip content={`Impostos: ${taxes}% | Cart√£o: ${cardFee}% | Outros: ${otherExpenses}%`} /></span>
                                                <span>- R$ {(sellingPrice * (totalVariablePercent/100)).toFixed(2)}</span>
                                            </div>
                                            <div className="flex justify-between text-emerald-400 font-bold border-t border-[#0F3555] pt-2 mt-2">
                                                <span>Lucro L√≠quido Real</span>
                                                <span>R$ {(sellingPrice * (margin/100)).toFixed(2)}</span>
                                            </div>
                                        </div>

                                        <div className="p-4 bg-[#05121d] border-t border-[#F59425]/20">
                                            <div className="flex justify-between items-center">
                                                <div className="text-left">
                                                    <p className="text-xs text-orange-400 font-bold uppercase">Pre√ßo M√≠nimo</p>
                                                    <p className="text-[10px] text-slate-500">Zero Lucro (Pagar contas)</p>
                                                </div>
                                                <div className="text-xl font-bold text-orange-400">
                                                    R$ {minPrice.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {sellingPrice <= 0 && (
                                            <div className="p-3 bg-red-900/50 text-red-200 text-xs text-center">
                                                Aten√ß√£o: A soma das porcentagens √© alta demais. Revise as margens.
                                            </div>
                                        )}
                                    </div>
                                </div>

                            </div>
                        )}
                    </div>
                    {/* --- MODAL: SISTEMA DE CONFIRMA√á√ÉO & ALERTA --- */}
                    {alertConfig && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#05121d]/90 backdrop-blur-md animate-pop">
                            <div className="bg-[#0F3555] p-6 rounded-xl border border-[#0F3555] shadow-2xl max-w-sm w-full text-center relative overflow-hidden">
                                {alertConfig.type === 'alert' && <div className="absolute top-0 left-0 w-full h-1 bg-red-500 shadow-[0_0_10px_#ef4444]"></div>}
                                {alertConfig.type === 'confirm' && <div className="absolute top-0 left-0 w-full h-1 bg-[#F59425] shadow-[0_0_10px_#F59425]"></div>}
                                
                                <div className="mb-4 flex justify-center text-slate-300">
                                    {alertConfig.type === 'alert' ? <Icons.Alert size={40} className="text-red-400" /> : <Icons.Rocket size={40} className="text-[#F59425]" />}
                                </div>

                                <h3 className="text-lg font-bold text-white mb-2">{alertConfig.type === 'alert' ? 'Aten√ß√£o' : 'Confirma√ß√£o'}</h3>
                                <p className="text-slate-300 mb-6 text-sm">{alertConfig.message}</p>
                                
                                <div className="flex gap-3 justify-center">
                                    {alertConfig.type === 'confirm' && (
                                        <button 
                                            onClick={closeAlert}
                                            className="px-4 py-2 rounded-lg border border-slate-500 text-slate-300 hover:bg-[#05121d] transition-colors"
                                        >
                                            Cancelar
                                        </button>
                                    )}
                                    <button 
                                        onClick={() => {
                                            if (alertConfig.onConfirm) alertConfig.onConfirm();
                                            closeAlert();
                                        }}
                                        className={`px-6 py-2 rounded-lg text-white font-bold transition-all shadow-lg ${alertConfig.type === 'alert' ? 'bg-red-600 hover:bg-red-500' : 'bg-[#F59425] hover:bg-orange-600'}`}
                                    >
                                        {alertConfig.type === 'alert' ? 'Entendi' : 'Sim, continuar'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* --- MODAL DE AJUDA --- */}
                    {isHelpOpen && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#05121d]/90 backdrop-blur-md animate-pop">
                            <div className="bg-[#0F3555] w-full max-w-2xl h-[80vh] rounded-xl border border-[#0F3555] shadow-2xl flex flex-col relative overflow-hidden">
                                
                                {/* Cabe√ßalho do Modal */}
                                <div className="p-4 border-b border-[#F59425]/30 flex justify-between items-center bg-[#05121d]">
                                    <h3 className="font-bold text-white flex items-center gap-2">
                                        <Icons.HelpCircle size={20} className="text-[#F59425]" /> 
                                        Manual de Uso
                                    </h3>
                                    <button onClick={() => setIsHelpOpen(false)} className="text-slate-400 hover:text-white transition-colors">
                                        <Icons.X size={24} />
                                    </button>
                                </div>

                                {/* Conte√∫do do Manual (Com Scroll) */}
                                <div className="p-6 overflow-y-auto text-slate-300 leading-relaxed text-sm flex-1">
                                    
                                    <div className="mb-6">
                                        <h4 className="text-[#F59425] font-bold text-lg mb-2 flex items-center gap-2">
                                            <Icons.DollarSign size={18} /> 1. FLUXO DE CAIXA
                                        </h4>
                                        <p className="mb-2">Use esta tela para anotar tudo o que entra e sai da empresa.</p>
                                        <ul className="list-disc pl-5 space-y-1 mb-3">
                                            <li><strong>Adicionar Lan√ßamento:</strong> Preencha data, descri√ß√£o e valor.</li>
                                            <li><strong>Status:</strong> Escolha "Pago" para dinheiro que j√° movimentou, ou "Agendado" para contas futuras.</li>
                                            <li><strong>Repetir/Parcelar:</strong> Marque para criar parcelas autom√°ticas (ex: 10x sem juros ou aluguel mensal).</li>
                                        </ul>
                                        <div className="bg-[#05121d] p-3 rounded border border-[#F59425]/20 text-xs">
                                            <strong>Entendendo os Saldos:</strong><br/>
                                            ‚Ä¢ <span className="text-emerald-400">Saldo Real:</span> Dinheiro que voc√™ tem HOJE (apenas "Pago").<br/>
                                            ‚Ä¢ <span className="text-cyan-400">Saldo Previsto:</span> Vis√£o de futuro (Hoje + Agendado).<br/>
                                            ‚Ä¢ <span className="text-orange-400">Saldo do M√™s:</span> Lucro ou preju√≠zo apenas da opera√ß√£o deste m√™s.
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        <h4 className="text-[#F59425] font-bold text-lg mb-2 flex items-center gap-2">
                                            <Icons.FileText size={18} /> 2. RELAT√ìRIOS
                                        </h4>
                                        <p className="mb-2">Analise a sa√∫de do seu neg√≥cio com filtros inteligentes.</p>
                                        <ul className="list-disc pl-5 space-y-1">
                                            <li>Use o seletor <strong>"Per√≠odo"</strong> para ver "Este M√™s", "M√™s Passado" ou datas personalizadas.</li>
                                            <li>O card <strong>"Vis√£o Geral (Acumulado)"</strong> mostra o saldo total da hist√≥ria da empresa.</li>
                                            <li>Use os bot√µes de <strong>Imprimir</strong> ou <strong>Baixar CSV</strong> para salvar seus dados.</li>
                                        </ul>
                                    </div>

                                    <div className="mb-6">
                                        <h4 className="text-[#F59425] font-bold text-lg mb-2 flex items-center gap-2">
                                            <Icons.Calculator size={18} /> 3. PRE√áO JUSTO (RAIO-X)
                                        </h4>
                                        <p className="mb-2">Descubra se est√° cobrando o valor certo.</p>
                                        <ol className="list-decimal pl-5 space-y-2">
                                            <li><strong>Valor da Hora:</strong> Defina seu sal√°rio desejado e horas de trabalho.</li>
                                            <li><strong>Custo de Produ√ß√£o:</strong> Some materiais + tempo gasto por produto.</li>
                                            <li><strong>Venda:</strong> Coloque impostos, taxas e a margem de lucro l√≠quido que deseja.</li>
                                        </ol>
                                        <p className="mt-2 text-xs italic">O "Raio-X" mostrar√° o pre√ßo ideal de venda e o pre√ßo m√≠nimo (sem lucro) para n√£o ter preju√≠zo.</p>
                                    </div>

                                    <div className="border-t border-slate-700 pt-4 mt-4 text-center text-xs text-slate-500">
                                        <p>Seus dados s√£o salvos automaticamente no seu dispositivo. Ningu√©m tem acesso a eles.</p>
                                    </div>
                                </div>
                                
                                {/* Rodap√© do Modal */}
                                <div className="p-4 bg-[#05121d] border-t border-[#F59425]/30 text-center">
                                    <button 
                                        onClick={() => setIsHelpOpen(false)}
                                        className="bg-[#F59425] text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors font-bold shadow-[0_0_10px_#F59425]"
                                    >
                                        Entendi, vamos lucrar!
                                    </button>
                                </div>

                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <!-- Script para ativar o Modo Offline (Service Worker) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((reg) => console.log('Financeiro pronto para uso offline!', reg.scope))
                    .catch((err) => console.log('Falha ao registrar offline:', err));
            });
        }
    </script>
</body>
</html>